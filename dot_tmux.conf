# üìº CASSETTE FUTURISM: HEAVY INDUSTRY EDITION üìº
# "No Signal // Static Memories"

# --- Plugins ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'MunifTanjim/tmux-mode-indicator'
set -g @plugin 'olimorris/tmux-pomodoro-plus'
set -g @plugin 'robhurring/tmux-uptime'
set -g @plugin 'xamut/tmux-weather'

# --- General Settings ---
set -g default-terminal "xterm-256color"
set-option -ga terminal-overrides ",*256col*:Tc"
set-environment -g PATH "/opt/homebrew/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"
tmux_conf_copy_to_os_clipboard=true
set-option -g status "on"
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Keybindings
bind r command-prompt -I "#W" "rename-window '%%'"
# Close all other panes in the current window (Prefix + C-w)
bind C-w kill-pane -a
# Layout: main-left top, bottom-left bar, right column split (Prefix+L)
bind L kill-pane -a \; split-window -h -p 30 \; split-window -v -p 50 \; select-pane -t 1 \; split-window -v -p 25 \; select-pane -t 1

# --- Theme Management ---
# Default to Dark Mode if not set
if-shell "test ! -f ~/.tmux/theme_state" "run-shell 'echo dark > ~/.tmux/theme_state'"
# Load the current theme
if-shell "grep -q dark ~/.tmux/theme_state" "source-file ~/.tmux/themes/dark.conf" "source-file ~/.tmux/themes/light.conf"

# Toggle Theme Keybinding (Prefix + T)
bind T run-shell "~/.tmux/toggle_theme.sh"

# --- Status Bar Structure ---
set -g status-position bottom

set -g status-style "bg=default,fg=#{@tape_fg}"
set -g status-justify left
set -g status-left-length 150
set -g status-right-length 150
set -g status-interval 2

# --- Plugin Config ---
# Mode Indicator Styles
set -g @mode_indicator_prefix_prompt " COMMAND "
set -g @mode_indicator_copy_prompt " COPYING "
set -g @mode_indicator_sync_prompt " SYNCING "
set -g @mode_indicator_empty_prompt " TMUX "
set -g @mode_indicator_prefix_mode_style "bg=#{@tape_orange},fg=#{@tape_dark},bold"
set -g @mode_indicator_copy_mode_style "bg=#{@tape_yellow},fg=#{@tape_dark},bold"
set -g @mode_indicator_sync_mode_style "bg=#{@tape_red},fg=#{@tape_dark},bold"
set -g @mode_indicator_empty_mode_style "bg=#{@tape_cyan},fg=#{@tape_dark},bold"

# Weather
set -g @tmux-weather-format "%c %t"
set -g @tmux-weather-location "Chengdu"

# Pomodoro
set -g @pomodoro_on " #[fg=#{@tape_red}]Ôâí "
set -g @pomodoro_complete " #[fg=#{@tape_green}]ÔÅò "
set -g @pomodoro_pause " #[fg=#{@tape_yellow}]ÔÅå "
set -g @pomodoro_prompt_break " #[fg=#{@tape_green}]ÔÉ¥ ? "
set -g @pomodoro_prompt_pomodoro " #[fg=#{@tape_red}]ÔÄó ? "

# --- Left: Control Deck ---
set -g status-left ""
# 1. Mode Indicator (Dynamic Status Machine)
set -ga status-left "#{tmux_mode_indicator}"
# 2. Decorative Connectors
set -ga status-left "#[bg=default,fg=#{@tape_gray}] ‚â£ "
# 3. Session Identifier
set -ga status-left "#[fg=#{@tape_purple},bold]Ôäí #S #[fg=#{@tape_gray}]‚â£ "
# 4. Hardware Monitor
set -ga status-left "#[fg=#{@tape_cyan}]CPU:#{cpu_percentage} #[fg=#{@tape_gray}]| "
set -ga status-left "#[fg=#{@tape_pink}]RAM:#{ram_percentage} "

# --- Right: Status Array ---
set -g status-right ""
# 1. Pomodoro Timer
set -ga status-right "#{pomodoro_status}#[fg=#{@tape_gray}] | "
# 3. Uptime
set -ga status-right "#[fg=#{@tape_yellow}]UP:#{uptime} #[fg=#{@tape_gray}]| "
# 4. Spectrum
set -ga status-right "#[fg=#{@tape_purple}] ‚ñÇ‚ñÉ‚ñÖ#[fg=#{@tape_cyan}]‚ñÜ‚ñá#[fg=#{@tape_green}]‚ñà "
# 5. Battery
set -ga status-right "#[fg=#{@tape_gray}]| #[fg=#{@tape_orange}]‚ö°#{battery_percentage} "
# 6. Weather
set -ga status-right "#[fg=#{@tape_gray}]| #[fg=#{@tape_blue}]#{weather} "
# 7. Time
set -ga status-right "#[fg=#{@tape_gray}]| #[fg=#{@tape_fg}]%H:%M #[fg=#{@tape_red},bold]%y.%m.%d "
# 8. End Cap
set -ga status-right "#[fg=#{@tape_gray}]‚ñì‚ñí‚ñë"




# --- Window Status (Playlist) ---
set -g window-status-separator ""

# Inactive: Dimmed track info
set -g window-status-format "#[fg=#{@tape_gray}] #[fg=#{@tape_gray}]#I.#(~/.tmux/icons.sh #{pane_current_command}) #W "

# Active: "Now Playing" highlight with solid block
set -g window-status-current-format "#[bg=#{@tape_active_bg},fg=#{@tape_active_fg},bold] #I.#(~/.tmux/icons.sh #{pane_current_command}) #W "

# Activity Alert
set -g window-status-activity-style "fg=#{@tape_orange},blink"

# --- Pane Borders (The Frame) ---
setw -g pane-border-status top
setw -g pane-border-format "#{?pane_active,#[fg=#{@tape_cyan}]‚ïî‚ïê[ #P: #W ]‚ïê‚ïó,#[fg=#{@tape_gray}]‚îå‚îÄ[ #P ]‚îÄ‚îê}"
setw -g pane-active-border-style "fg=#{@tape_cyan},bg=default"
setw -g pane-border-style "fg=#{@tape_gray},bg=default"
setw -g pane-border-lines double

# --- Message / Command Mode ---
set -g message-style "bg=#{@tape_dark},fg=#{@tape_cyan},border-style=double"
set -g message-command-style "bg=#{@tape_dark},fg=#{@tape_orange}"

# --- Clock Mode ---
setw -g clock-mode-colour "#8be9fd"
setw -g clock-mode-style 24


# --- Bootstrap TPM ---
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

run '~/.tmux/plugins/tpm/tpm'
